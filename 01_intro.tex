Grid-connected distributed energy resources (DERs), have seen exponential growth in the last few years. The unprecedented growth of DERs has been driven by the decentralization of power systems and the growth in deployment of distributed generation (DG) and distributed storage (DS) systems by both utility companies and consumers. Progressively, energy storage systems are becoming more competitive. Companies are starting to heavily invest in the development of lithium-ion batteries, thermal storage, and other types of DS systems with the objective of decreasing energy costs and stabilizing the distribution system. 

DG and DS systems have the potential of becoming the cornerstone of the future smart grid. Nonetheless, these systems are still not ready for a harmonious integration to the grid due to their lack of control and intermittent nature of DG \cite{denholm2016path}. In the US, most of the DG and DS systems are being deployed under two basic operating principles: 1) to help in the reduction of metered load through net metering programs, and 2) to sell real power generation to utility companies through power purchase agreements (PPAs). These unsophisticated methods of transactions with the energy market limit the optimal utilization of DER systems. The lack of control and dispatchability of these systems can lead to power being lost due to DG diversion. That's why, in order to maximize the DG penetration and effective utilization of available resources, DERs need to have a more sophisticated control approach that dynamically leverages all the resources available to the system while serving the load in an economical, reliable, and safe way. Such optimal control of the energy resources will translate into direct benefits to both utility companies and regular consumers. Due to the intermittent characteristics and constraints present in some DER systems, such as solar and wind, optimal dispatch control has become a challenging optimization problem tackled by many researchers.

Energy management algorithms which deal with both variable DG and real-time pricing can be divided into two main categories, offline and real-time algorithms \cite{rt_shi_2017}. The offline optimization algorithms usually optimize the energy management for a predetermined time horizon based on prediction data. Some research has been done considering perfect prediction of the future \cite{Off_1,off_2,off_3,off_4}. But in reality, there are uncertainties in the prediction horizon. To solve the problem of reliance on perfect prediction some offline algorithms, try to model the uncertainties in a day ahead scheduling and try to develop optimum schedules taking into account the probable uncertainties. \cite{ous_1,ous_2} use mixed integer linear programming for optimizing DERs. To take into account the uncertainties in the prediction horizon \cite{ous_2} generates multiple solutions based on different scenarios. \cite{ous_1} also produces different risk averse and risk-neutral options. In both cases, the scenarios are generated stochastically. The number of scenarios required to be generated to properly capture the uncertainties are large in number. This makes these process computationally extensive. The researchers in \cite{ous_3} formulate the optimization problem based on the worst-case scenario. The solution method considers the most cost from the grid and the least benefits from using local DG resources. The uncertainty of the grid is expressed as set points in Taguchi’s orthogonal array. Then search strategy based on Taguchi’s orthogonal array is used to find the best possible solution cases. Using the worst case to formulate the problem makes the solution robust for all situations. Although this method provides a robust solution always taking into account worst scenario makes the solution suboptimal. 

There have been advances recently in designing real-time algorithms that optimize the long-term cost of the energy management system taking into account the intermittent nature of the loads and DGs in the grid. Researchers in \cite{rt1} use an aggregator to minimize the long-term cost of the grid. The solution used Lyapunov optimization to solve the energy management problem in real-time. The method proposed does not consider the actual architecture of the grid and optimizes considering all the components are connected to the same bus. This makes it impractical due to the actual grid having line constraints that cannot be violated.\cite{rt2} formulates the problem as a real-time one leader N-follower Stackelberg game and shows an efficient approach designed to optimize the system based on a demand response scheme. The optimization is performed by creating a virtual electricity trading market where the facility (leader) produces virtual prices of electricity and the resources (followers) compete to buy and sell electricity. The researchers show the existence of unique Stackelberg equilibrium for optimum use of each resource. In \cite{rt3}, researchers propose a multi-period AC optimal power flow taking into account the uncertainties of the solar and wind resources to ensure reliable solutions for the distribution system operators. In the first stage the algorithm contacts with all the available resources to determine the upper and lower bounds of generation throughout the next day. The upper and lower bounds of the different units are termed as flexibility in the paper. In the second stage which is the real-time operation, the algorithm optimizes in real-time taking into account the flexibility of the available resources.  \cite{rt4} proposes to solve the problem using an online energy management system in real-time using Lyapunov optimization taking into account the physical constraints of the system.
The drawbacks of these methods are that most of them do not take into account the actual distribution system architecture while formulating the problem. Only \cite{rt4} considers system architecture while optimizing in real-time. But a lack of prediction based elements makes these methods optimal for short-term costs but suboptimal for properly optimizing long-term operating cost.

From the discussion thus far it is evident that there is a need for a real-time energy management solution(EMS) that can optimize the long-term operating cost of a system containing  DG and energy storage (ES). This paper presents an optimal real-time control strategy for such systems. The proposed control strategy takes into account the forecasted states of the available resources and real-time price to optimize the total cost of energy usage. the rest of the paper is structured as follows. Section II introduces the formulation of the problem as a graph search. Section III introduces the A* search algorithm which is used to solve the optimization problem. Section IV discusses the test system. Section V presents results and section VI presents the conclusions.

