\subsection{A* search algorithm}
A* is a computer algorithm which is widely used to solve graph search problems. It determines the most efficient path between multiple nodes in a graph. A* is an informed search algorithm. This means it searches between all the possible paths to the goal and finds the path incurring the least cost. To do this it considers the paths which appear to have the least cost to get to the goal first. Starting from a specific node it explores the graph step by step depending on the cost of going from one node to the next. The algorithm selects the note to explore based on a combination of the actual cost to get to the node and a heuristic cost that estimates the cost from the current node to the goal. The process to calculate heuristic cost is problem-specific. For the algorithm to work properly the heuristic cost has to be less than or equal to the actual cost of getting to the goal node. This means the heuristic cost function should never overestimate the cost for reaching the goal. The algorithm works by calculating the combined actual and heuristic cost for all the neighboring nodes of the starting node and puts them into a priority queue called the open list. Then it selects the node with the least cost and expands that node to get the cost of its neighbors. The expanded node is taken out of the priority queue and put in another list called the closed list. then the algorithm continues to expand the open list always selecting the node with the least cost and adding it to the closed list. The algorithm stops when the goal node is in the open list and it has the minimum cost in the open list. Then the algorithm retraces it's path through the closed list to find the optimum path.

\subsection{Implementation}
By defining the solution space with a combination of nodes and edges the optimization problem can be formulated as a graph search problem. At the start, the starting node is determined by the current status of the system. Then the following nodes and edges are generated using the forecasted data available. A discrete set of endpoints are set as the goals. The A*  algorithm runs for all the goal nodes and the node with the lowest path cost is selected as the best end node. The shortest graph search path to that node is selected as the optimum path.

The following are the main steps of the search algorithm,
\input{_A8_algorithm.tex}

The EMS recalculates the optimum path using the search algorithm at every time step based on the updated information. The system status is assumed to be constant between time steps.

%\subsection{Cost Calculation}
The cost of going from a parent node to a child node is calculated by combining the real cost of getting to that child node and heuristic cost of getting to the goal from that child node. The real cost of going from a parent node $p$ at time $T=t$ to a child node $c$ at time $T=t+\Delta T$ is denoted as $C_{actual}(pc)$. It is calculated according to equation (\ref{eq:C_actual}).

\begin{equation}
\label{eq:C_actual}
    C_{actual}(pc) =  C_{ESS}(pc)+C_{GRID}(t)+C_{best}(p)
\end{equation}

Here, $\Delta T$ represents the time between two time steps. $C_{actual}(pc)$ represent the total cost of going to the child node $c$ from parent node $p$. $C_{ESS}(pc)$ represent cost of energy storage to go from parent node $p$ to child node $c$. $C_{GRID}(t)$ is the cost of using the grid between time $T=t$ and time $T=t+\Delta T$. $C_{best}(p)$ represent the best or least cost to get to the parent node $p$. $C_{ESS}(pc)$ is calculated according to equation \ref{eq:C_ESS}.

\begin{equation}
\label{eq:C_ESS}
C_{ESS}(pc) = |(SOC_p - SOC_c)|*ESS_{CAP}*R_{ESS} 
\end{equation}
Here, $SOC_p$ and $SOC_c$ represent the state of charge at parent and child node. $ESS_{CAP}$ represent the total energy capacity of the energy storage. And $R_{ESS}$ is the $\$/kWh$ cost of using the energy storage. $C_{GRID}(t)$ is calculated according to equation \ref{eq:C_GRID}.

\begin{equation}
\label{eq:C_GRID}
C_{GRID}(t) = 
\begin{cases}
   E_{GRID}(t)*RTP(t),& \text{if } E_{GRID}(t)\geq 0\\
    E_{GRID}(t)*SP(t),& \text{if }  E_{GRID}(t) < 0
\end{cases}
\end{equation}

Here, $E_{GRID}(t)$ is the energy drawn from the grid between time $T=t$ and time $T=t+\Delta T$. $RTP(t)$ is the real time price between $t$ and $t+\Delta T$. $SP(t)$ is the price the utility is willing to pay the consumer for selling power between $t$ and $t+\Delta T$.

The heuristic cost is calculated by assuming that whichever source has a smaller cost during a time step will supply the total demand of that time step. The heuristic cost of a node at time $T = t$ is calculated according to equation \ref{eq:C_H}.


\begin{equation}
\label{eq:C_H}
C_H(t) = \sum_{n=t}^{end} D(t)*R_{best}(t)
\end{equation}

Here, $C_H(t)$ represent the heuristic cost. $D(t)$ is the demand between time $T = t$ and time $T = t+\Delta T$. $R_{best}(t)$ is the source with the smaller cost which is calculated according to equation \ref{eq:R_best}

\begin{equation}
\label{eq:R_best}
R_{best}(t) = 
\begin{cases}
    R_{ESS},& \text{if } RTP(t)\geq R_{ESS}\\
    RTP(t),              & \text{otherwise}
\end{cases}
\end{equation}

After calculating the actual cost  $C_{actual}(pc)$ and heuristic cost $C_H(t)$ the total cost is calculated by adding  $C_{actual}(pc)$ and $C_H(t)$.

